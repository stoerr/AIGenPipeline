<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>AIInOut.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">AIGenPipeline Command Line Tool</a> &gt; <a href="../index.html" class="el_bundle">aigenpipeline-framework</a> &gt; <a href="index.source.html" class="el_package">net.stoerr.ai.aigenpipeline.framework.task</a> &gt; <span class="el_source">AIInOut.java</span></div><h1>AIInOut.java</h1><pre class="source lang-java linenums">package net.stoerr.ai.aigenpipeline.framework.task;

import static java.util.Objects.requireNonNull;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;

import javax.annotation.Nonnull;
import javax.annotation.Nullable;

/**
 * AIInOut is an interface that represents an input or output for AI tasks.
 * We join input and output since in some cases we need to read the file, too.
 */
public interface AIInOut {

    /**
     * Reads the input and returns it as a string.
     *
     * @return the input as a string
     * @throws IllegalStateException if the input cannot be read
     */
    String read() throws IllegalStateException;

    /**
     * Writes a string to the output.
     *
     * @param content the string to write
     */
    void write(String content)  ;


    /**
     * The underlying file.
     */
    File getFile();

    default boolean sameFile(AIInOut other) {
<span class="nc" id="L43">        return getFile().getAbsolutePath().equals(other.getFile().getAbsolutePath());</span>
    }

    default boolean exists() {
<span class="nc bnc" id="L47" title="All 4 branches missed.">        return null != getFile() &amp;&amp; getFile().exists();</span>
    }

    /**
     * Creates an AIInOut instance that reads from a file.
     *
     * @param file the file to read from
     * @return an AIInOut instance
     */
    @Nullable
    static AIInOut of(@Nullable File file) {
<span class="nc bnc" id="L58" title="All 2 branches missed.">        return file != null ? new AIFileInOut(requireNonNull(file)) : null;</span>
    }


    /**
     * Creates an AIInOut instance that reads from a file.
     *
     * @param path the path to the file to read from
     * @return an AIInOut instance
     */
    @Nullable
    static AIInOut of(@Nullable Path path) {
<span class="nc bnc" id="L70" title="All 2 branches missed.">        return path != null ? new AIFileInOut(requireNonNull(path.toFile())) : null;</span>
    }

    /**
     * Creates an AIInOut instance that reads from a segment of a segmented file.
     *
     * @param segmentedFile the segmented file to read from
     * @param segmentIndex  the index of the segment to read
     * @return an AIInOut instance
     */
    @Nonnull
    static AIInOut of(@Nonnull SegmentedFile segmentedFile, int segmentIndex) {
<span class="nc" id="L82">        return new AIFileSegmentInOut(requireNonNull(segmentedFile), segmentIndex);</span>
    }


    /**
     * Creates an AIInOut instance that reads from an input stream. Writing is not supported.
     *
     * @param in the input stream to read from
     * @return an AIInOut instance
     */
    static AIInOut of(InputStream in) {
<span class="nc" id="L93">        return new AIStreamInOut(in);</span>
    }

    /**
     * AIFileInOut is an implementation of AIInOut that reads from a file.
     */
    class AIFileInOut implements AIInOut {

        private final File file;

        /**
         * Constructs an AIFileInOut instance.
         *
         * @param file the file to read from
         */
<span class="nc" id="L108">        public AIFileInOut(File file) {</span>
<span class="nc" id="L109">            this.file = file;</span>
<span class="nc" id="L110">        }</span>

        /**
         * Reads the file and returns its content as a string.
         *
         * @return the file content as a string
         */
        public String read() throws IllegalStateException {
            try {
<span class="nc" id="L119">                return Files.readString(file.toPath(), StandardCharsets.UTF_8);</span>
<span class="nc" id="L120">            } catch (IOException e) {</span>
<span class="nc" id="L121">                throw new IllegalStateException(&quot;Could not read &quot; + file, e);</span>
            }
        }

        /**
         * Writes a string to the file.
         *
         * @param content the string to write
         */
        @Override
        public void write(String content)   {
            try {
<span class="nc" id="L133">                Files.write(file.toPath(), content.getBytes(StandardCharsets.UTF_8));</span>
<span class="nc" id="L134">            } catch (IOException e) {</span>
<span class="nc" id="L135">                throw new IllegalStateException(&quot;Could not write &quot; + file, e);</span>
<span class="nc" id="L136">            }</span>
<span class="nc" id="L137">        }</span>

        public File getFile() {
<span class="nc" id="L140">            return file;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L145">            return file.toString();</span>
        }
    }

    /**
     * AIFileSegmentInOut is an implementation of AIInOut that reads from a segment of a segmented file.
     */
    class AIFileSegmentInOut implements AIInOut {

        protected final SegmentedFile segmentedFile;
        protected final int segmentIndex;

        /**
         * Constructs an AIFileSegmentInOut instance.
         *
         * @param segmentedFile the segmented file to read from
         * @param segmentIndex  the index of the segment to read
         */
<span class="nc" id="L163">        public AIFileSegmentInOut(SegmentedFile segmentedFile, int segmentIndex) {</span>
<span class="nc" id="L164">            this.segmentedFile = segmentedFile;</span>
<span class="nc" id="L165">            this.segmentIndex = segmentIndex;</span>
<span class="nc" id="L166">        }</span>

        /**
         * Reads the segment from the segmented file and returns its content as a string.
         *
         * @return the segment content as a string
         */
        public String read()   {
<span class="nc" id="L174">            return segmentedFile.getSegment(segmentIndex);</span>
        }

        /**
         * Writes a string to the segment of the segmented file.
         *
         * @param content the string to write
         */
        @Override
        public void write(String content)   {
            try {
<span class="nc" id="L185">                segmentedFile.writeSegment(segmentIndex, content);</span>
<span class="nc" id="L186">            } catch (IOException e) {</span>
<span class="nc" id="L187">                throw new IllegalStateException(&quot;Could not write segment &quot; + segmentIndex + &quot; of &quot; + segmentedFile, e);</span>
<span class="nc" id="L188">            }</span>
<span class="nc" id="L189">        }</span>

        @Override
        public File getFile() {
<span class="nc" id="L193">            return segmentedFile.getFile();</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L198">            return segmentedFile.getFile() + &quot; segment &quot; + segmentIndex;</span>
        }
    }

    /**
     * AIStreamInOut is an implementation of AIInOut that reads from an input stream.
     */
    class AIStreamInOut implements AIInOut {

        private final InputStream in;

        /**
         * Constructs an AIStreamInOut instance.
         *
         * @param in the input stream to read from
         */
<span class="nc" id="L214">        public AIStreamInOut(InputStream in) {</span>
<span class="nc" id="L215">            this.in = in;</span>
<span class="nc" id="L216">        }</span>

        /**
         * Reads the input stream and returns its content as a string.
         *
         * @return the input stream content as a string
         */
        public String read() throws IllegalStateException {
            try {
<span class="nc" id="L225">                return new String(in.readAllBytes(), StandardCharsets.UTF_8);</span>
<span class="nc" id="L226">            } catch (IOException e) {</span>
<span class="nc" id="L227">                throw new IllegalStateException(&quot;Could not read input stream&quot;, e);</span>
            }
        }

        /**
         * Writing to an input stream is not supported.
         *
         * @param content the string to write
         */
        @Override
        public void write(String content) {
<span class="nc" id="L238">            throw new UnsupportedOperationException(&quot;Writing to an input stream is not supported&quot;);</span>
        }

        @Override
        public File getFile() {
<span class="nc" id="L243">            return null;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L248">            return &quot;input stream&quot;;</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>