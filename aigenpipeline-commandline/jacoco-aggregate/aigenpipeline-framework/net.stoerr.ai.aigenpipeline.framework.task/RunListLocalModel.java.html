<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>RunListLocalModel.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">AIGenPipeline Command Line Tool</a> &gt; <a href="../index.html" class="el_bundle">aigenpipeline-framework</a> &gt; <a href="index.source.html" class="el_package">net.stoerr.ai.aigenpipeline.framework.task</a> &gt; <span class="el_source">RunListLocalModel.java</span></div><h1>RunListLocalModel.java</h1><pre class="source lang-java linenums">package net.stoerr.ai.aigenpipeline.framework.task;

import java.io.IOException;
import java.net.URI;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.nio.charset.StandardCharsets;

/**
 * Strangely, connections to LM Studio block for an unknown reason. That seems to be either an issue with LM Studio
 * or the java.net.http.HttpClient. If I use the burpsuite as proxy, it works.
 */
<span class="nc" id="L14">public class RunListLocalModel {</span>

    public static void main(String[] args) throws IOException, InterruptedException {
<span class="nc" id="L17">        System.out.println(&quot;Hello, World!&quot;);</span>
<span class="nc" id="L18">        String url = &quot;http://localhost:1234/v1/chat/completions&quot;;</span>
<span class="nc" id="L19">        HttpClient client = HttpClient.newBuilder().followRedirects(HttpClient.Redirect.NEVER)</span>
<span class="nc" id="L20">                .connectTimeout(java.time.Duration.ofSeconds(20))</span>
                // .proxy(ProxySelector.of(InetSocketAddress.createUnresolved(&quot;localhost&quot;, 8080)))
<span class="nc" id="L22">                .build();</span>
<span class="nc" id="L23">        String json = &quot;{\n&quot; +</span>
                &quot;  \&quot;model\&quot;: \&quot;gpt-3.5-turbo\&quot;,\n&quot; +
                &quot;  \&quot;messages\&quot;: [\n&quot; +
                &quot;    {\n&quot; +
                &quot;      \&quot;role\&quot;: \&quot;user\&quot;,\n&quot; +
                &quot;      \&quot;content\&quot;: \&quot;Print what technology you're based on, as a short identifier. Print only the manufacturer and model identifier, no other text.\\n\&quot;\n&quot; +
                &quot;    }\n&quot; +
                &quot;  ],\n&quot; +
                &quot;  \&quot;temperature\&quot;: 0.0,\n&quot; +
                &quot;  \&quot;max_tokens\&quot;: 2048\n&quot; +
                &quot;}&quot;;
<span class="nc" id="L34">        HttpRequest request = HttpRequest.newBuilder()</span>
<span class="nc" id="L35">                .uri(URI.create(url))</span>
<span class="nc" id="L36">                .header(&quot;Content-Type&quot;, &quot;application/json&quot;)</span>
<span class="nc" id="L37">                .timeout(java.time.Duration.ofSeconds(40))</span>
<span class="nc" id="L38">                .POST(HttpRequest.BodyPublishers.ofString(json)).build();</span>
<span class="nc" id="L39">        HttpResponse.BodyHandler&lt;String&gt; bodyHandler = (rspInfo) -&gt; {</span>
<span class="nc" id="L40">            System.out.println(&quot;Response Info: &quot; + rspInfo.statusCode());</span>
<span class="nc" id="L41">            return HttpResponse.BodySubscribers.ofString(StandardCharsets.UTF_8);</span>
        };
        // HttpResponse response = client.send(request, HttpResponse.BodyHandlers.ofString(StandardCharsets.UTF_8));
<span class="nc" id="L44">        HttpResponse response = client.send(request, bodyHandler);</span>
<span class="nc" id="L45">        System.out.println(&quot;Response Code: &quot; + response.statusCode());</span>
<span class="nc" id="L46">        System.out.flush();</span>
<span class="nc" id="L47">        System.out.printf(&quot;Response: %s%n&quot;, response.body());</span>
<span class="nc" id="L48">    }</span>
}

/*
curl http://localhost:1234/v1/chat/completions \
  -H &quot;Content-Type: application/json&quot; \
  -d '{
    &quot;model&quot;: &quot;TheBloke/Mistral-7B-Instruct-v0.2-GGUF&quot;,
    &quot;messages&quot;: [
      { &quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;Always answer in rhymes.&quot; },
      { &quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Introduce yourself.&quot; }
    ],
    &quot;temperature&quot;: 0.7,
    &quot;max_tokens&quot;: -1,
    &quot;stream&quot;: false
}'

 */
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>